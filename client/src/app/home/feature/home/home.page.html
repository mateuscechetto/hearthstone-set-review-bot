<div class="grid">
  <h1 class="col-12 flex-order-1 md:flex-order-0 md:col-6 md:col-offset-3 text-center">{{ title }}</h1>
  <p-button class="col-3 col-offset-9 flex-order-0 md:flex-order-1 md:col-1 md:col-offset-2"
    *ngIf="loggedUser; else loginButton" label="Logout" (onClick)="logout()"></p-button>
  <ng-template #loginButton>
    <p-button class="col-3 col-offset-9 flex-order-0 md:flex-order-1 md:col-1 md:col-offset-2" label="Login"
      (onClick)="login()"></p-button>
  </ng-template>
</div>
<div class="grid md:ml-1">
  <div class="col-12 flex-order-2  lg:flex-order-0 grid">
    <div class="col-12 flex justify-content-end">
      <a [routerLink]="['/stats']" style="color: inherit;">
      See full stats
    </a>
    </div>
    <div class="col-12 mb-4 lg:col-4">
      <p-table [value]="bestCards">
        <ng-template pTemplate="caption">
          <span pTooltip="Best cards based on Users Ratings" tooltipPosition="top"> Best Cards </span>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th>Class</th>
            <th>Name</th>
            <th *ngIf="bestCards[0]?.hsr_rating" 
              pTooltip="Rating calculated using HSReplay data from the 28.2 patch"
              tooltipPosition="top"
            > Final Rating
            </th>
            <th
              pTooltip="Average of Users Ratings" 
              tooltipPosition="top"
            > Avg.</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-card>
          <tr [ngClass]="card.hsClass" pTooltip="<img src='{{card.imageURL}}' style='width: 180px'/>" [escape]="false" tooltipPosition="right">
            <td>{{card.hsClass}}</td>
            <td>{{card.name}}</td>
            <td *ngIf="card?.hsr_rating">{{ card.hsr_rating  | number: '1.0-1' }}</td>
            <td>{{card.avgRating | number: '1.0-2' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <div class="col-12 mb-4 lg:col-4">
      <p-table [value]="standardDeviationCards" class="mb-1">
        <ng-template pTemplate="caption">
          <span pTooltip="Cards with highest User Ratings standard deviation" tooltipPosition="top">Most Controversial Cards </span>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th>Class</th>
            <th>Name</th>
            <th 
              pTooltip="Average of Users Ratings" 
              tooltipPosition="top"
            > Avg.</th>
            <th
            pTooltip="Standard Deviation of Users Ratings" 
            tooltipPosition="top"
            >SD</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-card>
          <tr [ngClass]="card.hsClass" pTooltip="<img src='{{card.imageURL}}' style='width: 180px'/>" [escape]="false" tooltipPosition="right">
            <td>{{card.hsClass}}</td>
            <td>{{card.name}}</td>
            <td>{{card.avgRating | number: '1.0-2' }}</td>
            <td>Â±{{card.standardDeviation | number: '1.0-2' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <div class="col-12 lg:col-4">
    <p-table [value]="worstCards">
      <ng-template pTemplate="caption">
        <span pTooltip="Worst cards based on Users Ratings" tooltipPosition="top"> Worst Cards </span>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th>Class</th>
          <th>Name</th>
          <th *ngIf="worstCards[0]?.hsr_rating" 
              pTooltip="Rating calculated using HSReplay data from the 28.2 patch"
              tooltipPosition="top"
            > Final Rating
            </th>
          <th
            pTooltip="Average of Users Ratings" 
            tooltipPosition="top"
          >Avg.</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-card>
        <tr [ngClass]="card.hsClass" pTooltip="<img src='{{card.imageURL}}' style='width: 180px'/>" [escape]="false" tooltipPosition="right">
          <td>{{card.hsClass}}</td>
          <td>{{card.name}}</td>
          <td *ngIf="card?.hsr_rating">{{ card.hsr_rating  | number: '1.0-1' }}</td>
          <td>{{card.avgRating | number: '1.0-2' }}</td>
        </tr>
      </ng-template>
    </p-table>
    </div>
  </div>
  <div class="col-12 hidden flex-order-0  lg:flex-order-1 lg:flex banner">
      <h2> See who reviewed the cards</h2>
  </div>
  <div class="col-12 flex-order-1  lg:flex-order-2">
    <p-table 
      *ngIf="usersWithRating[0]?.totalDeviation"
      [value]="usersWithRating" 
      [rows]="10" 
      [paginator]="true"
      >
        <ng-template pTemplate="caption"> Reviewers </ng-template>
        <ng-template pTemplate="header">
          <tr>      
            <th pSortableColumn="name" style="width:60%">Twitch Username <p-sortIcon field="name"></p-sortIcon></th>
            <th 
              pSortableColumn="score"
              style="width:40%"
              pTooltip="Score is calculated based on the difference between the User's Rating and the Real Rating. The higher is the score, the better is the review."
              tooltipPosition="bottom"
            > Score <p-sortIcon field="score"></p-sortIcon>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
          <tr class="listItem">
            <td class="p-0"><a [routerLink]="'/review/' + user.name" class="col-12 flex h-3rem align-items-center remove-link-appearance">
            <p-avatar [image]="user.image" styleClass="ml-1 mr-4" shape="circle"></p-avatar>
            {{user.name}}
          </a></td>
            <td class="p-0"><a [routerLink]="'/review/' + user.name" class="col-12 flex h-3rem align-items-center remove-link-appearance">{{ user.score | number: '1.0-2' }}</a></td>
          </tr>
        </ng-template>
    </p-table>
    <p-dataView [value]="usersWithRating" [layout]="'list'" [rows]="10" [paginator]="true" *ngIf="!usersWithRating[0]?.totalDeviation">
      <ng-template pTemplate="header">
        <div class="flex flex-column md:flex-row md:justify-content-between">
          Reviews
        </div>
      </ng-template>
      <ng-template let-user pTemplate="listItem">
        <a [routerLink]="'/review/' + user.name" class="col-12 flex h-3rem align-items-center listItem">
          <p-avatar [image]="user.image" styleClass="ml-1 mr-4" shape="circle"></p-avatar>
          {{user.name}}
        </a>
      </ng-template>
    </p-dataView>
  </div>
</div>